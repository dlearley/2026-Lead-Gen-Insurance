// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ========================================
// USERS & AUTHENTICATION
// ========================================

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  firstName String?
  lastName  String?
  role      UserRole @default(USER)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  notes         Note[]
  activities    ActivityLog[]
  emailsSent    Email[]       @relation("EmailSender")
  tasksCreated  Task[]        @relation("TaskCreator")
  tasksAssigned Task[]        @relation("TaskAssignee")
  notifications Notification[]

  @@map("users")
}

enum UserRole {
  USER
  ADMIN
  SUPER_ADMIN
}

// ========================================
// LEADS
// ========================================

model Lead {
  id             String         @id @default(uuid())
  source         LeadSource     @default(MANUAL)
  email          String?
  phone          String?
  firstName      String?
  lastName       String?
  street         String?
  city           String?
  state          String?
  zipCode        String?
  country        String?

  // Insurance details - merged from both versions
  insuranceType  InsuranceType?
  insuranceTypes InsuranceType[] @default([])
  currentProvider String?
  policyExpiryDate DateTime?

  // Lead information - enhanced from Phase 2.2
  dateOfBirth    DateTime?
  urgency        Urgency       @default(MEDIUM)
  intent         String?
  qualityScore   Float?

  // AI processing - from Phase 2.2
  aiProcessedAt   DateTime?
  aiScoreReason   String?
  similarityScore Float?
  enrichedData    Json?

  // Status and metadata
  status         LeadStatus    @default(RECEIVED)
  metadata       Json?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt

  // Relations - merged from both versions
  notes         Note[]
  activities    ActivityLog[]
  emails        Email[]
  tasks         Task[]
  assignments   LeadAssignment[]
  events        LeadEvent[]

  @@index([status])
  @@index([email])
  @@index([createdAt])
  @@index([source])
  @@index([urgency])
  @@map("leads")
}

enum LeadSource {
  WEB_FORM
  PHONE
  EMAIL
  REFERRAL
  PARTNER_API
  MANUAL
}

enum InsuranceType {
  AUTO
  HOME
  LIFE
  HEALTH
  COMMERCIAL
  RENTERS
  UMBRELLA
  DISABILITY
  LONG_TERM_CARE
  PET
}

enum LeadStatus {
  RECEIVED
  PROCESSING
  QUALIFIED
  ROUTED
  CONTACTED
  CONVERTED
  REJECTED
  DUPLICATE
  INVALID
}

enum Urgency {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

// ========================================
// LEAD EVENTS (from Phase 2.2)
// ========================================

model LeadEvent {
  id          String   @id @default(uuid())
  leadId      String
  eventType   String
  eventData   Json?
  source      String?
  createdAt   DateTime @default(now())

  // Relations
  lead Lead @relation(fields: [leadId], references: [id], onDelete: Cascade)

  @@index([leadId])
  @@index([eventType])
  @@index([createdAt])
  @@map("lead_events")
}

// ========================================
// NOTES & COMMENTS
// ========================================

model Note {
  id         String           @id @default(uuid())
  leadId     String
  authorId   String
  content    String           @db.Text
  visibility NoteVisibility   @default(TEAM)
  createdAt  DateTime         @default(now())
  updatedAt  DateTime         @updatedAt

  // Relations
  lead        Lead            @relation(fields: [leadId], references: [id], onDelete: Cascade)
  author      User            @relation(fields: [authorId], references: [id])
  attachments NoteAttachment[]

  @@index([leadId])
  @@index([authorId])
  @@index([createdAt])
  @@map("notes")
}

enum NoteVisibility {
  PRIVATE
  TEAM
  PUBLIC
}

model NoteAttachment {
  id        String   @id @default(uuid())
  noteId    String
  fileName  String
  fileUrl   String
  fileSize  Int
  mimeType  String
  createdAt DateTime @default(now())

  // Relations
  note Note @relation(fields: [noteId], references: [id], onDelete: Cascade)

  @@index([noteId])
  @@map("note_attachments")
}

// ========================================
// ACTIVITY LOG & TIMELINE
// ========================================

model ActivityLog {
  id          String       @id @default(uuid())
  leadId      String
  userId      String?
  activityType ActivityType
  action      String
  description String?
  metadata    Json?
  createdAt   DateTime     @default(now())

  // Relations
  lead Lead  @relation(fields: [leadId], references: [id], onDelete: Cascade)
  user User? @relation(fields: [userId], references: [id])

  @@index([leadId])
  @@index([userId])
  @@index([activityType])
  @@index([createdAt])
  @@map("activity_logs")
}

enum ActivityType {
  LEAD_CREATED
  LEAD_UPDATED
  STATUS_CHANGED
  ASSIGNMENT_CREATED
  ASSIGNMENT_UPDATED
  NOTE_CREATED
  NOTE_UPDATED
  NOTE_DELETED
  EMAIL_SENT
  EMAIL_RECEIVED
  TASK_CREATED
  TASK_UPDATED
  TASK_COMPLETED
  SYSTEM_ACTION
  WORKFLOW_TRIGGERED
}

// ========================================
// EMAIL COMMUNICATION
// ========================================

model Email {
  id          String      @id @default(uuid())
  leadId      String
  senderId    String
  to          String[]
  cc          String[]    @default([])
  bcc         String[]    @default([])
  subject     String
  body        String      @db.Text
  bodyHtml    String?     @db.Text
  templateId  String?
  threadId    String?
  status      EmailStatus @default(PENDING)
  sentAt      DateTime?
  openedAt    DateTime?
  clickedAt   DateTime?
  scheduledFor DateTime?
  error       String?
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  // Relations
  lead        Lead             @relation(fields: [leadId], references: [id], onDelete: Cascade)
  sender      User             @relation("EmailSender", fields: [senderId], references: [id])
  template    EmailTemplate?   @relation(fields: [templateId], references: [id])
  attachments EmailAttachment[]

  @@index([leadId])
  @@index([senderId])
  @@index([threadId])
  @@index([status])
  @@index([createdAt])
  @@map("emails")
}

enum EmailStatus {
  PENDING
  SCHEDULED
  SENT
  DELIVERED
  OPENED
  CLICKED
  FAILED
  BOUNCED
}

model EmailTemplate {
  id          String   @id @default(uuid())
  name        String
  subject     String
  body        String   @db.Text
  bodyHtml    String?  @db.Text
  variables   String[] @default([])
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  emails Email[]

  @@map("email_templates")
}

model EmailAttachment {
  id        String   @id @default(uuid())
  emailId   String
  fileName  String
  fileUrl   String
  fileSize  Int
  mimeType  String
  createdAt DateTime @default(now())

  // Relations
  email Email @relation(fields: [emailId], references: [id], onDelete: Cascade)

  @@index([emailId])
  @@map("email_attachments")
}

// ========================================
// TASKS & FOLLOW-UPS
// ========================================

model Task {
  id          String       @id @default(uuid())
  leadId      String
  creatorId   String
  assigneeId  String?
  title       String
  description String?      @db.Text
  status      TaskStatus   @default(OPEN)
  priority    TaskPriority @default(MEDIUM)
  dueDate     DateTime?
  completedAt DateTime?
  recurrence  String?
  metadata    Json?
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  // Relations
  lead     Lead  @relation(fields: [leadId], references: [id], onDelete: Cascade)
  creator  User  @relation("TaskCreator", fields: [creatorId], references: [id])
  assignee User? @relation("TaskAssignee", fields: [assigneeId], references: [id])

  @@index([leadId])
  @@index([assigneeId])
  @@index([status])
  @@index([dueDate])
  @@index([priority])
  @@map("tasks")
}

enum TaskStatus {
  OPEN
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum TaskPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

// ========================================
// NOTIFICATIONS
// ========================================

model Notification {
  id        String             @id @default(uuid())
  userId    String
  type      NotificationType
  title     String
  message   String
  entityType String?
  entityId  String?
  isRead    Boolean            @default(false)
  readAt    DateTime?
  metadata  Json?
  createdAt DateTime           @default(now())

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([isRead])
  @@index([createdAt])
  @@map("notifications")
}

enum NotificationType {
  TASK_ASSIGNED
  TASK_DUE_SOON
  TASK_OVERDUE
  NOTE_MENTION
  EMAIL_RECEIVED
  LEAD_ASSIGNED
  LEAD_UPDATED
  SYSTEM_ALERT
}

// ========================================
// AGENTS
// ========================================

model Agent {
  id                  String      @id @default(uuid())
  firstName           String
  lastName            String
  email               String      @unique
  phone               String
  licenseNumber       String
  specializations     InsuranceType[]
  city                String
  state               String
  country             String
  zipCode             String?

  // Performance metrics - enhanced from Phase 2.2
  rating              Float       @default(0)
  averageResponseTime Int         @default(0)
  conversionRate      Float       @default(0)
  totalLeadsAssigned  Int         @default(0)
  totalLeadsConverted Int         @default(0)

  // Capacity management - enhanced from Phase 2.2
  maxLeadCapacity     Int         @default(10)
  currentLeadCount    Int         @default(0)

  // Status and authentication - enhanced from Phase 2.2
  status              AgentStatus @default(ACTIVE)
  isActive            Boolean     @default(true)
  passwordHash        String?
  lastLoginAt         DateTime?

  // Education and Skills (Phase 29)
  educationLevel      EducationLevel @default(NONE)
  totalTrainingHours  Int         @default(0)
  certificationsCount Int         @default(0)
  lastTrainingDate    DateTime?
  expertiseAreas      String[]    @default([])
  skillAssessments    Json?       // JSON of skill assessments
  learningGoals       String[]    @default([])
  preferredLearningStyle LearningStyle @default(VIDEO)
  educationMetadata   Json?       // Additional education metadata

  createdAt           DateTime    @default(now())
  updatedAt           DateTime    @updatedAt

  // Relations
  assignments         LeadAssignment[]
  courseEnrollments   CourseEnrollment[]
  pathEnrollments     PathEnrollment[]
  certifications      CourseCertification[]

  @@index([email])
  @@index([isActive])
  @@index([status])
  @@index([state])
  @@map("agents")
}

enum AgentStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
  PENDING_VERIFICATION
}

model LeadAssignment {
  id         String               @id @default(uuid())
  leadId     String
  agentId    String
  status     LeadAssignmentStatus @default(PENDING)

  // Enhanced matching fields from Phase 2.2
  matchScore  Float?
  matchReason String?
  priority    Int                  @default(0)

  // Timestamps
  assignedAt DateTime             @default(now())
  acceptedAt DateTime?
  rejectedAt DateTime?
  viewedAt   DateTime?

  // Conversion tracking from Phase 2.2
  convertedAt DateTime?
  conversionValue Float?

  notes      String?

  // Relations
  lead  Lead  @relation(fields: [leadId], references: [id], onDelete: Cascade)
  agent Agent @relation(fields: [agentId], references: [id])

  @@index([leadId])
  @@index([agentId])
  @@index([status])
  @@index([assignedAt])
  @@map("lead_assignments")
}

enum LeadAssignmentStatus {
  PENDING
  ACCEPTED
  REJECTED
  TIMEOUT
  EXPIRED
}

// ========================================
// SYSTEM CONFIGURATION (from Phase 2.2)
// ========================================

model SystemConfig {
  id        String   @id @default(uuid())
  key       String   @unique
  value     Json
  category  String?
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([key])
  @@index([category])
  @@map("system_config")
}

// ========================================
// INSURANCE CARRIER & BROKER INTEGRATIONS (Phase 8.6)
// ========================================

model InsuranceCarrier {
  id                String               @id @default(uuid())
  name              String
  code              String               @unique
  website           String?
  logoUrl           String?
  contactEmail      String?
  contactPhone      String?

  // Carrier capabilities
  supportedProducts InsuranceType[]
  apiEndpoint       String?
  webhookUrl        String?
  documentationUrl  String?

  // Integration details
  integrationType   IntegrationType      @default(REST_API)
  apiKey            String?
  apiSecret         String?
  apiVersion        String?

  // Configuration
  isActive          Boolean              @default(true)
  isPrimary         Boolean              @default(false)
  priority          Int                  @default(0)

  // Rate limiting
  rateLimit         Int                  @default(100)
  rateLimitWindow   Int                  @default(60) // seconds

  // Metadata
  metadata          Json?
  createdAt         DateTime             @default(now())
  updatedAt         DateTime             @updatedAt

  // Relations
  brokers           Broker[]
  configs           IntegrationConfig[]
  logs              IntegrationLog[]

  @@index([code])
  @@index([isActive])
  @@index([integrationType])
  @@map("insurance_carriers")
}

model Broker {
  id                String               @id @default(uuid())
  name              String
  code              String               @unique
  website           String?
  logoUrl           String?
  contactEmail      String?
  contactPhone      String?

  // Broker details
  licenseNumber     String?
  ein               String?
  businessAddress   Json?

  // Carrier relationships
  carrierId         String?
  carrier           InsuranceCarrier?    @relation(fields: [carrierId], references: [id])

  // Integration details
  integrationType   IntegrationType      @default(REST_API)
  apiKey            String?
  apiSecret         String?
  apiVersion        String?

  // Configuration
  isActive          Boolean              @default(true)
  priority          Int                  @default(0)

  // Rate limiting
  rateLimit         Int                  @default(100)
  rateLimitWindow   Int                  @default(60)

  // Metadata
  metadata          Json?
  createdAt         DateTime             @default(now())
  updatedAt         DateTime             @updatedAt

  // Relations
  configs           IntegrationConfig[]
  logs              IntegrationLog[]

  @@index([code])
  @@index([isActive])
  @@index([integrationType])
  @@map("brokers")
}

model IntegrationConfig {
  id          String               @id @default(uuid())
  name        String
  description String?

  // Entity references
  carrierId   String?
  carrier     InsuranceCarrier?    @relation(fields: [carrierId], references: [id], onDelete: Cascade)
  brokerId    String?
  broker      Broker?              @relation(fields: [brokerId], references: [id], onDelete: Cascade)

  // Configuration
  configType  IntegrationConfigType
  config      Json                 // Configuration data (endpoints, mappings, etc.)

  // Status
  isActive    Boolean              @default(true)
  isEnabled   Boolean              @default(true)

  // Metadata
  metadata    Json?
  createdAt   DateTime             @default(now())
  updatedAt   DateTime             @updatedAt

  // Relations
  logs        IntegrationLog[]

  @@index([configType])
  @@index([isActive])
  @@index([isEnabled])
  @@map("integration_configs")
}

model IntegrationLog {
  id          String             @id @default(uuid())
  entityType  IntegrationEntityType
  entityId    String

  // Entity references
  carrierId   String?
  carrier     InsuranceCarrier?  @relation(fields: [carrierId], references: [id], onDelete: Cascade)
  brokerId    String?
  broker      Broker?            @relation(fields: [brokerId], references: [id], onDelete: Cascade)
  configId    String?
  config      IntegrationConfig? @relation(fields: [configId], references: [id], onDelete: Cascade)

  // Log details
  action      IntegrationAction
  direction   Direction          @default(OUTBOUND)
  requestData Json?
  responseData Json?
  statusCode  Int?
  success     Boolean
  error       String?

  // Performance
  duration    Int?               // milliseconds

  // Metadata
  metadata    Json?
  createdAt   DateTime           @default(now())

  @@index([entityType, entityId])
  @@index([action])
  @@index([success])
  @@index([createdAt])
  @@map("integration_logs")
}

// Enums for integrations

enum IntegrationType {
  REST_API
  SOAP_API
  WEBHOOK
  FTP
  SFTP
  FILE_IMPORT
  FILE_EXPORT
}

enum IntegrationConfigType {
  API_ENDPOINTS
  MAPPING_RULES
  VALIDATION_RULES
  TRANSFORMATION_RULES
  NOTIFICATION_SETTINGS
  RATE_LIMITING
  AUTHENTICATION
}

enum IntegrationEntityType {
  INSURANCE_CARRIER
  BROKER
  LEAD
  POLICY
  CLAIM
  QUOTE
}

enum IntegrationAction {
  LEAD_SUBMITTED
  LEAD_STATUS_UPDATE
  QUOTE_REQUESTED
  QUOTE_RECEIVED
  POLICY_CREATED
  POLICY_UPDATED
  CLAIM_SUBMITTED
  CLAIM_STATUS_UPDATE
  WEBHOOK_RECEIVED
  DATA_SYNC
  VALIDATION_CHECK
  ERROR_RETRY
}

enum Direction {
  INBOUND
  OUTBOUND
}

// ========================================
// BROKER EDUCATION & UPSKILLING PLATFORM (Phase 29)
// ========================================

// Course Management
model Course {
  id          String      @id @default(uuid())
  title       String
  description String?     @db.Text
  category    CourseCategory
  level       CourseLevel @default(BEGINNER)
  
  // Course structure
  duration    Int         // Duration in minutes
  estimatedHours Float?   // Estimated completion hours
  
  // Content management
  thumbnailUrl String?
  contentType ContentType @default(VIDEO)
  isMandatory Boolean     @default(false)
  isActive    Boolean     @default(true)
  
  // Learning objectives
  objectives  String[]    @default([])
  prerequisites String[]  @default([])
  
  // Metadata
  tags        String[]    @default([])
  createdBy   String?
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  
  // Relations
  modules     CourseModule[]
  enrollments CourseEnrollment[]
  certifications CourseCertification[]
  
  @@index([category])
  @@index([level])
  @@index([isActive])
  @@index([tags])
  @@map("courses")
}

enum CourseCategory {
  ONBOARDING
  COMPLIANCE
  PRODUCTS
  SALES_TECHNIQUES
  CUSTOMER_SERVICE
  REGULATORY
  TECHNOLOGY
  LEADERSHIP
  SPECIALIZATIONS
  CONTINUING_EDUCATION
}

enum CourseLevel {
  BEGINNER
  INTERMEDIATE
  ADVANCED
  EXPERT
}

enum ContentType {
  VIDEO
  DOCUMENT
  INTERACTIVE
  WEBINAR
  SIMULATION
  QUIZ
}

model CourseModule {
  id          String    @id @default(uuid())
  courseId    String
  title       String
  description String?   @db.Text
  orderIndex  Int
  
  // Module content
  content     Json      // Flexible content structure
  duration    Int?      // Duration in minutes
  isRequired  Boolean   @default(true)
  
  // Assessment
  hasQuiz     Boolean   @default(false)
  passingScore Int?     @default(70)
  
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  
  // Relations
  course     Course     @relation(fields: [courseId], references: [id], onDelete: Cascade)
  quizzes    ModuleQuiz[]
  progresses ModuleProgress[]
  
  @@index([courseId])
  @@index([orderIndex])
  @@map("course_modules")
}

model ModuleQuiz {
  id          String     @id @default(uuid())
  moduleId    String
  title       String
  description String?    @db.Text
  
  // Quiz configuration
  questions  Json       // Quiz questions structure
  timeLimit  Int?       // Time limit in minutes
  maxAttempts Int       @default(3)
  passingScore Int      @default(70)
  
  // Shuffle settings
  shuffleQuestions Boolean @default(false)
  shuffleAnswers   Boolean @default(false)
  
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  
  // Relations
  module     CourseModule @relation(fields: [moduleId], references: [id], onDelete: Cascade)
  attempts   QuizAttempt[]
  
  @@index([moduleId])
  @@map("module_quizzes")
}

// Learning Paths
model LearningPath {
  id          String        @id @default(uuid())
  title       String
  description String?       @db.Text
  category    CourseCategory
  level       CourseLevel   @default(BEGINNER)
  
  // Path structure
  estimatedHours Float?     // Total estimated completion time
  isMandatory Boolean      @default(false)
  isActive    Boolean      @default(true)
  
  // Prerequisites
  prerequisites String[]   @default([])
  
  // Target audience
  targetRoles   String[]   @default([])
  specialization InsuranceType[]
  
  // Metadata
  tags        String[]     @default([])
  createdBy   String?
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  
  // Relations
  courses     PathCourse[]
  enrollments PathEnrollment[]
  
  @@index([category])
  @@index([level])
  @@index([isActive])
  @@map("learning_paths")
}

model PathCourse {
  id            String      @id @default(uuid())
  learningPathId String
  courseId      String
  orderIndex    Int
  
  // Completion requirements
  isRequired    Boolean     @default(true)
  passingScore   Int?        @default(70)
  
  createdAt     DateTime    @default(now())
  
  // Relations
  learningPath LearningPath @relation(fields: [learningPathId], references: [id], onDelete: Cascade)
  course       Course       @relation(fields: [courseId], references: [id])
  
  @@index([learningPathId])
  @@index([courseId])
  @@index([orderIndex])
  @@map("path_courses")
}

// Enrollment and Progress Tracking
model CourseEnrollment {
  id          String            @id @default(uuid())
  courseId    String
  agentId     String
  status      EnrollmentStatus  @default(ENROLLED)
  
  // Progress tracking
  progress    Float             @default(0) // 0-100
  completedAt DateTime?
  
  // Assessment scores
  finalScore  Int?              // Final course score
  passingScore Int?              // Passing score achieved
  
  // Timing
  enrolledAt  DateTime          @default(now())
  startedAt   DateTime?
  completedAt DateTime?
  
  // Relations
  course      Course            @relation(fields: [courseId], references: [id])
  agent       Agent            @relation(fields: [agentId], references: [id])
  moduleProgresses ModuleProgress[]
  
  @@unique([courseId, agentId])
  @@index([agentId])
  @@index([status])
  @@map("course_enrollments")
}

model ModuleProgress {
  id              String     @id @default(uuid())
  enrollmentId    String
  moduleId        String
  status          ProgressStatus @default(NOT_STARTED)
  
  // Progress tracking
  progress        Float      @default(0) // 0-100
  timeSpent       Int       @default(0) // Time spent in minutes
  
  // Completion tracking
  startedAt       DateTime?
  completedAt     DateTime?
  
  // Relations
  enrollment      CourseEnrollment @relation(fields: [enrollmentId], references: [id], onDelete: Cascade)
  module          CourseModule    @relation(fields: [moduleId], references: [id])
  quizAttempts   QuizAttempt[]
  
  @@unique([enrollmentId, moduleId])
  @@index([moduleId])
  @@index([status])
  @@map("module_progress")
}

enum ProgressStatus {
  NOT_STARTED
  IN_PROGRESS
  COMPLETED
  FAILED
}

enum EnrollmentStatus {
  ENROLLED
  IN_PROGRESS
  COMPLETED
  DROPPED
  FAILED
}

model PathEnrollment {
  id             String           @id @default(uuid())
  learningPathId String
  agentId        String
  status         EnrollmentStatus @default(ENROLLED)
  
  // Progress tracking
  progress       Float            @default(0) // 0-100
  completedAt    DateTime?
  
  // Timing
  enrolledAt     DateTime        @default(now())
  startedAt      DateTime?
  completedAt    DateTime?
  
  // Relations
  learningPath   LearningPath    @relation(fields: [learningPathId], references: [id])
  agent          Agent           @relation(fields: [agentId], references: [id])
  
  @@unique([learningPathId, agentId])
  @@index([agentId])
  @@index([status])
  @@map("path_enrollments")
}

// Assessment System
model QuizAttempt {
  id           String         @id @default(uuid())
  quizId       String
  moduleProgressId String
  
  // Attempt details
  attemptNumber Int
  score        Int            // Score achieved (0-100)
  passed       Boolean
  timeSpent    Int?           // Time spent in minutes
  
  // Questions and answers
  answers      Json           // User's answers
  correctAnswers Json?        // Correct answers (for review)
  
  // Timing
  startedAt    DateTime       @default(now())
  completedAt  DateTime?
  
  // Relations
  quiz         ModuleQuiz     @relation(fields: [quizId], references: [id])
  moduleProgress ModuleProgress @relation(fields: [moduleProgressId], references: [id])
  
  @@index([quizId])
  @@index([moduleProgressId])
  @@index([passed])
  @@map("quiz_attempts")
}

// Certification System
model CourseCertification {
  id          String       @id @default(uuid())
  courseId    String
  agentId     String
  
  // Certification details
  certificateNumber String @unique
  score        Int        // Score achieved
  issuedAt     DateTime   @default(now())
  expiresAt    DateTime?
  
  // Certification metadata
  version     String      @default("1.0")
  isActive    Boolean     @default(true)
  
  // Relations
  course      Course       @relation(fields: [courseId], references: [id])
  agent       Agent        @relation(fields: [agentId], references: [id])
  
  @@unique([courseId, agentId])
  @@index([agentId])
  @@index([isActive])
  @@map("course_certifications")
}

// Integration with Agent model - add education fields
// Note: This would extend the existing Agent model above
/*
  // Education and Skills (add to existing Agent model)
  educationLevel EducationLevel @default(NONE)
  totalTrainingHours Int       @default(0)
  certificationsCount Int       @default(0)
  lastTrainingDate DateTime?
  expertiseAreas   String[]    @default([])
  skillAssessments Json?       // JSON of skill assessments
  learningGoals    String[]    @default([])
  preferredLearningStyle LearningStyle @default(VIDEO)
*/

enum EducationLevel {
  NONE
  HIGH_SCHOOL
  ASSOCIATE
  BACHELOR
  MASTER
  DOCTORATE
}

enum LearningStyle {
  VIDEO
  TEXT
  INTERACTIVE
  HANDS_ON
  GROUP
}
