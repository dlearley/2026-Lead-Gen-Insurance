apiVersion: v1
kind: ConfigMap
metadata:
  name: postgres-config
data:
  # PostgreSQL Configuration
  POSTGRES_DB: insurance_lead_gen
  POSTGRES_USER: postgres

  # Connection Settings
  MAX_CONNECTIONS: "200"
  SHARED_BUFFERS: "4GB"
  EFFECTIVE_CACHE_SIZE: "12GB"
  MAINTENANCE_WORK_MEM: "1GB"
  CHECKPOINT_COMPLETION_TARGET: "0.9"
  WAL_BUFFERS: "16MB"
  DEFAULT_STATISTICS_TARGET: "100"
  RANDOM_PAGE_COST: "1.1"
  EFFECTIVE_IO_CONCURRENCY: "200"
  WORK_MEM: "2621kB"
  MIN_WAL_SIZE: "2GB"
  MAX_WAL_SIZE: "8GB"

  # Replication
  REPLICATION_MODE: "streaming"
  SYNCHRONOUS_COMMIT: "on"
  SYNCHRONOUS_STANDBY_NAMES: "ANY 1"

  # WAL Configuration
  WAL_LEVEL: replica
  MAX_WAL_SENDERS: "10"
  WAL_KEEP_SIZE: "1GB"

  # Logging
  LOG_STATEMENT: all
  LOG_DURATION: on
  LOG_LINE_PREFIX: '%t [%p]: [%l-1] user=%u,db=%d,app=%a,client=%h '
  LOG_MIN_DURATION_STATEMENT: "1000"
  LOG_CHECKPOINTS: on
  LOG_CONNECTIONS: on
  LOG_DISCONNECTIONS: on
  LOG_LOCK_WAITS: on

  # Performance Tuning
  MAX_WORKER_PROCESSES: "8"
  MAX_PARALLEL_WORKERS_PER_GATHER: "4"
  MAX_PARALLEL_WORKERS: "8"
  MAX_PARALLEL_MAINTENANCE_WORKERS: "4"

  # Auto-Vacuum
  AUTOVACUUM: on
  AUTOVACUUM_MAX_WORKERS: "3"
  AUTOVACUUM_NAPTIME: "1min"
  AUTOVACUUM_VACUUM_SCALE_FACTOR: "0.1"
  AUTOVACUUM_ANALYZE_SCALE_FACTOR: "0.05"
