# Neo4j Helm Chart Production Values
# Production configuration for Neo4j deployment

# Neo4j edition
neo4j:
  edition: "enterprise"
  name: "neo4j"
  # Password from secret or override here
  # password: ""  # Use Kubernetes secret instead

# Cluster configuration
# For production, use multiple replicas
replicaCount: 5

# Resources (r6i.2xlarge: 64GB RAM, 8 vCPU)
resources:
  requests:
    cpu: "4"
    memory: "16Gi"
  limits:
    cpu: "8"
    memory: "32Gi"

# Persistent volume for data (500GB)
volumes:
  data:
    mode: "dynamic"
    storageClassName: "gp3-encrypted"
    disk: "500Gi"

# Service configuration
services:
  neo4j:
    type: "LoadBalancer"
    enabled: true
    annotations:
      service.beta.kubernetes.io/aws-load-balancer-type: "nlb"
      service.beta.kubernetes.io/aws-load-balancer-scheme: "internal"

# Configuration
config:
  # Memory configuration (16GB heap, 24GB page cache)
  dbms.memory.heap.initial_size: "16G"
  dbms.memory.heap.max_size: "16G"
  dbms.memory.pagecache.size: "24G"

  # Network configuration
  dbms.default_listen_address: "0.0.0.0"
  dbms.connector.bolt.listen_address: "0.0.0.0:7687"
  dbms.connector.http.listen_address: "0.0.0.0:7474"
  dbms.connector.https.listen_address: "0.0.0.0:7473"

  # Cluster configuration
  dbms.mode: "CORE"
  causal_clustering.minimum_core_cluster_size_at_formation: "3"
  causal_clustering.minimum_core_cluster_size_at_runtime: "3"
  causal_clustering.initial_discovery_members: "neo4j-0.neo4j:5000,neo4j-1.neo4j:5000,neo4j-2.neo4j:5000"

  # Transaction configuration
  dbms.transaction.timeout: "60s"

  # Backup configuration
  dbms.backup.enabled: "true"
  dbms.backup.listen_address: "0.0.0.0:6362"

  # Security
  dbms.ssl.policy.bolt.enabled: "true"
  dbms.ssl.policy.bolt.base_directory: "certificates/bolt"
  dbms.ssl.policy.bolt.client_auth: "NONE"

  dbms.ssl.policy.https.enabled: "true"
  dbms.ssl.policy.https.base_directory: "certificates/https"
  dbms.ssl.policy.https.client_auth: "NONE"

  # Logging
  dbms.logs.http.enabled: "true"
  dbms.logs.query.enabled: "true"
  dbms.logs.query.parameter_logging_enabled: "true"
  dbms.logs.query.threshold: "5s"

  # Performance
  dbms.track_query_cpu_time: "true"
  dbms.track_query_allocation: "true"

  # Optimization
  dbms.jvm.additional: "-XX:+UseG1GC -XX:MaxGCPauseMillis=200 -XX:InitiatingHeapOccupancyPercent=35"

# Pod disruption budget
podDisruptionBudget:
  enabled: true
  minAvailable: 2

# Liveness probe
livenessProbe:
  enabled: true
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

# Readiness probe
readinessProbe:
  enabled: true
  initialDelaySeconds: 10
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 3

# Service account
serviceAccount:
  create: true
  annotations:
    eks.amazonaws.com/role-arn: "arn:aws:iam::123456789012:role/neo4j-role"

# Pod annotations
podAnnotations:
  prometheus.io/scrape: "true"
  prometheus.io/port: "7474"
  prometheus.io/path: "/metrics"

# Node selector
nodeSelector:
  node.kubernetes.io/instance-type: "r6i.2xlarge"

# Tolerations
tolerations:
  - key: "workload"
    operator: "Equal"
    value: "neo4j"
    effect: "NoSchedule"

# Affinity
affinity:
  podAntiAffinity:
    requiredDuringSchedulingIgnoredDuringExecution:
      - labelSelector:
          matchExpressions:
            - key: app
              operator: In
              values:
                - neo4j
        topologyKey: "kubernetes.io/hostname"

# Backup cronjob
backupCronJob:
  enabled: true
  schedule: "0 2 * * *"  # 2 AM UTC
  retention: 30
  s3:
    bucket: "insurance-lead-gen-neo4j-backups"
    region: "us-east-1"
    # Credentials from secret
