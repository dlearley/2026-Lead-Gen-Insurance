# Production Values for Monitoring Stack

namespace: monitoring

# Global image pull secrets
imagePullSecrets: []

# Prometheus Configuration
prometheus:
  enabled: true
  image:
    repository: prom/prometheus
    tag: v2.48.1
    pullPolicy: IfNotPresent

  replicaCount: 2

  service:
    type: ClusterIP
    port: 9090

  resources:
    limits:
      cpu: 1000m
      memory: 2Gi
    requests:
      cpu: 500m
      memory: 1Gi

  retention: "30d"
  scrapeInterval: "15s"

  podSecurityContext:
    fsGroup: 65534
    runAsGroup: 65534
    runAsNonRoot: true
    runAsUser: 65534

  livenessProbe:
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3

  readinessProbe:
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3

  storage:
    className: gp3
    size: 100Gi

  affinity:
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          podAffinityTerm:
            labelSelector:
              matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                    - prometheus
            topologyKey: kubernetes.io/hostname

# Grafana Configuration
grafana:
  enabled: true
  image:
    repository: grafana/grafana
    tag: 10.2.3
    pullPolicy: IfNotPresent

  replicaCount: 2

  adminUser: admin
  adminPassword: CHANGE_ME_IN_PRODUCTION

  service:
    type: ClusterIP
    port: 3000

  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 250m
      memory: 256Mi

  plugins: "redis-datasource"

  serverRootURL: https://monitoring.insurance-lead-gen.com

  podSecurityContext:
    fsGroup: 472
    runAsGroup: 472
    runAsNonRoot: true
    runAsUser: 472

  livenessProbe:
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3

  readinessProbe:
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3

  storage:
    className: gp3
    size: 20Gi

  affinity:
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          podAffinityTerm:
            labelSelector:
              matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                    - grafana
            topologyKey: kubernetes.io/hostname

# Loki Configuration
loki:
  enabled: true
  image:
    repository: grafana/loki
    tag: 2.9.3
    pullPolicy: IfNotPresent

  replicaCount: 2

  service:
    type: ClusterIP
    port: 3100

  resources:
    limits:
      cpu: 500m
      memory: 1Gi
    requests:
      cpu: 250m
      memory: 512Mi

  retention: "30d"

  podSecurityContext:
    fsGroup: 10001
    runAsGroup: 10001
    runAsNonRoot: true
    runAsUser: 10001

  livenessProbe:
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3

  readinessProbe:
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3

  storage:
    className: gp3
    size: 50Gi

  affinity:
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          podAffinityTerm:
            labelSelector:
              matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                    - loki
            topologyKey: kubernetes.io/hostname

# AlertManager Configuration
alertmanager:
  enabled: true
  image:
    repository: prom/alertmanager
    tag: v0.26.0
    pullPolicy: IfNotPresent

  replicaCount: 2

  service:
    type: ClusterIP
    port: 9093

  resources:
    limits:
      cpu: 250m
      memory: 256Mi
    requests:
      cpu: 100m
      memory: 128Mi

  podSecurityContext:
    fsGroup: 65534
    runAsGroup: 65534
    runAsNonRoot: true
    runAsUser: 65534

  livenessProbe:
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3

  readinessProbe:
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3

  storage:
    className: gp3
    size: 5Gi

  affinity:
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          podAffinityTerm:
            labelSelector:
              matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                    - alertmanager
            topologyKey: kubernetes.io/hostname

# Jaeger Configuration (Optional - requires Elasticsearch)
jaeger:
  enabled: false  # Disabled by default, requires Elasticsearch
  collector:
    replicaCount: 2
    port: 14268
  query:
    replicaCount: 1
    port: 16686
  storage:
    type: elasticsearch
    elasticsearch:
      url: http://elasticsearch:9200

# Node Exporter
nodeExporter:
  enabled: true
  image:
    repository: prom/node-exporter
    tag: v1.7.0

# PostgreSQL Exporter
postgresExporter:
  enabled: true
  image:
    repository: prometheuscommunity/postgres-exporter
    tag: v0.15.0

# Redis Exporter
redisExporter:
  enabled: true
  image:
    repository: oliver006/redis_exporter
    tag: v1.56.0

# Ingress Configuration
ingress:
  enabled: true
  className: nginx
  annotations:
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/proxy-body-size: "10m"
    nginx.ingress.kubernetes.io/proxy-connect-timeout: "300"
    nginx.ingress.kubernetes.io/proxy-send-timeout: "300"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "300"
    cert-manager.io/cluster-issuer: "letsencrypt-prod"

  tls:
    - secretName: monitoring-tls
      hosts:
        - monitoring.insurance-lead-gen.com
        - grafana.insurance-lead-gen.com
        - prometheus.insurance-lead-gen.com
        - alertmanager.insurance-lead-gen.com

  hosts:
    - host: grafana.insurance-lead-gen.com
      service: grafana
      port: 3000
    - host: prometheus.insurance-lead-gen.com
      service: prometheus
      port: 9090
    - host: alertmanager.insurance-lead-gen.com
      service: alertmanager
      port: 9093

# Network Policies
networkPolicies:
  enabled: true

# Backup Configuration
backup:
  enabled: true
  schedule: "0 2 * * *"  # Daily at 2 AM
  retention: 7
